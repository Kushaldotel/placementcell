{% extends 'boiler_plate.html' %}
{% load static %}

{% block title %}Career Opportunities - Placement Cell{% endblock %}

{% block extra_css %}
<style>
    .career {
        background-color: rgba(0,0,0,0.03);
        min-height: 85vh;
    }

    .single-job {
        background-color: rgba(0,0,0,0.03);
        border-radius: 25px;
        padding: 30px;
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
        transition: transform 0.3s ease;
    }

    /* Animated border effect */
    .single-job::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border-radius: 25px;
        padding: 2px;
        background: linear-gradient(
            90deg,
            #68F2A0,
            #4CAF50,
            #2196F3,
            #68F2A0
        );
        -webkit-mask:
            linear-gradient(#fff 0 0) content-box,
            linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        animation: borderAnimation 4s linear infinite;
        background-size: 300% 100%;
    }

    @keyframes borderAnimation {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .single-job:hover {
        transform: translateY(-5px);
    }

    .single-job h6 {
        color: #68F2A0;
        font-size: 14px;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
        z-index: 1;
    }

    .single-job h3 {
        font-size: 22px;
        margin-bottom: 15px;
        font-weight: 600;
        color: #fff;
        position: relative;
        z-index: 1;
    }

    .single-job p {
        color: rgba(228, 230, 213, 0.95);
        margin-bottom: 20px;
        line-height: 1.6;
        position: relative;
        z-index: 1;
    }

    .job-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 20px;
        position: relative;
        z-index: 1;
    }

    .job-meta span {
        display: inline-flex;
        align-items: center;
        color: rgba(228, 230, 213, 0.95);
        font-size: 14px;
    }

    .job-meta span i {
        margin-right: 8px;
        color: #68F2A0;
    }

    .apply-btn {
        padding: 10px 25px;
        border-radius: 30px;
        background: linear-gradient(45deg, #68F2A0, #4CAF50);
        color: white;
        border: none;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        z-index: 1;
    }

    .apply-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.2),
            transparent
        );
        transition: 0.5s;
    }

    .apply-btn:hover::before {
        left: 100%;
    }

    .apply-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(104, 242, 160, 0.3);
        color: white;
    }

    /* Sidebar Styling */
    .career__sidebar {
        position: relative;
        z-index: 1;
    }

    .sidebar-widget {
        background-color: rgba(0,0,0,0.03);
        border-radius: 25px;
        padding: 25px;
        margin-bottom: 30px;
        position: relative;
    }

    .sidebar-widget::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border-radius: 25px;
        padding: 2px;
        background: linear-gradient(
            90deg,
            #68F2A0,
            #4CAF50,
            #2196F3,
            #68F2A0
        );
        -webkit-mask:
            linear-gradient(#fff 0 0) content-box,
            linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        animation: borderAnimation 4s linear infinite;
        background-size: 300% 100%;
    }


    element.style {
    }
    .input-group:not(.has-validation)>.dropdown-toggle:nth-last-child(n+3), .input-group:not(.has-validation)>.form-floating:not(:last-child)>.form-control, .input-group:not(.has-validation)>.form-floating:not(:last-child)>.form-select, .input-group:not(.has-validation)>:not(:last-child):not(.dropdown-toggle):not(.dropdown-menu):not(.form-floating) {
        color: white; }

    .sidebar-widget h4 {
        color: #fff;
        margin-bottom: 20px;
        position: relative;
        z-index: 1;
    }

    .form-control {
        background-color: rgba(0,0,0,0.2);
        border: 1px solid rgba(104, 242, 160, 0.2);
        color: #fff;
        border-radius: 15px;
        padding: 12px 15px;
        transition: all 0.3s ease;
    }


    .form-control:focus {
        border-color: #68F2A0;
        box-shadow: 0 0 15px rgba(104, 242, 160, 0.2);
        background-color: rgba(0,0,0,0.3);
    }

    .form-control::placeholder {
        color: rgba(228, 230, 213, 0.5);
    }

    .form-select {
        background-color: rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(104, 242, 160, 0.2);
        color: rgb(46 149 240 / 75%);
        border-radius: 15px;
    }

    .form-select:focus {
        border-color: #68F2A0;
        box-shadow: 0 0 15px rgba(104, 242, 160, 0.2);
    }

    /* Salary range slider styling */
    .salary-range-container {
        margin-top: 10px;
    }

    .salary-range-labels {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        color: rgba(228, 230, 213, 0.95);
        font-size: 14px;
    }

    .salary-range-select {
        width: 100%;
        background-color: rgba(0,0,0,0.2);
        border: 1px solid rgba(104, 242, 160, 0.2);
        color: rgba(228, 230, 213, 0.95);
        border-radius: 15px;
        padding: 8px;
    }

    /* Dual handle slider styling */
    .slider-container {
        margin: 20px 0;
        padding: 0 10px;
    }

    .slider-track {
        position: relative;
        height: 5px;
        background: rgba(104, 242, 160, 0.3);
        border-radius: 5px;
        margin: 20px 0;
    }

    .slider-range {
        position: absolute;
        height: 100%;
        background: linear-gradient(90deg, #68F2A0, #4CAF50);
        border-radius: 5px;
        z-index: 1;
    }

    .slider-handle {
        position: absolute;
        width: 20px;
        height: 20px;
        background: #fff;
        border: 2px solid #68F2A0;
        border-radius: 50%;
        cursor: pointer;
        z-index: 2;
        top: 50%;
        transform: translateY(-50%);
        transition: box-shadow 0.2s;
    }

    .slider-handle:hover {
        box-shadow: 0 0 10px rgba(104, 242, 160, 0.5);
    }

    .slider-handle.active {
        box-shadow: 0 0 15px rgba(104, 242, 160, 0.8);
    }

    .slider-values {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        color: rgba(228, 230, 213, 0.95);
        font-size: 14px;
    }

    .slider-value {
        background: rgba(0,0,0,0.2);
        padding: 5px 10px;
        border-radius: 15px;
        border: 1px solid rgba(104, 242, 160, 0.2);
    }
</style>
{% endblock %}
{% block content %}
<section class="page-header">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h1>Career Opportunities</h1>
            </div>
        </div>
    </div>
</section>

<div class="career pt-100 pb-100">
    <div class="container">
        <div class="row">
            <div class="col-lg-7 col-xl-8">
                <div class="career__wrapper">
                    <h5 class="magic-hover">Join Multiple Dynamic Team</h5>

                    <div class="career__wrapper--single">
                        {% if page_obj %}
                            {% for job in page_obj %}
                            <!-- single job -->
                            <div class="single-job">
                                <h6>{{ job.get_job_type_display }}</h6>
                                <h3 class="magic-hover">{{ job.title }}</h3>
                                <p>{{ job.description|striptags|truncatechars:200 }}</p>
                                <div class="job-meta mb-3">
                                    {% if job.location %}
                                    <span><i class="fa-solid fa-location-dot"></i> {{ job.location }}</span>
                                    {% endif %}
                                    {% if job.salary %}
                                    <span><i class="fa-solid fa-indian-rupee-sign"></i> {{ job.salary }}</span>
                                    {% endif %}
                                    <span><i class="fa-solid fa-calendar"></i> Posted: {{ job.posted_on|date:"M d, Y" }}</span>
                                </div>
                                <div class="single-job__btn">
                                    <a href="{% url 'job-detail-view' job.id %}" class="btn apply-btn">View Details</a>
                                </div>
                            </div>
                            <!-- single job end -->
                            {% endfor %}
                        {% else %}
                            <div class="alert alert-info">
                                No job vacancies found matching your criteria. Please try a different search.
                            </div>
                        {% endif %}
                    </div>

                    {% if page_obj.has_other_pages %}
                    <nav aria-label="Page navigation" class="mt-4">
                        <ul class="pagination justify-content-center">
                            {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if job_type %}&job_type={{ job_type }}{% endif %}{% if location %}&location={{ location }}{% endif %}{% if min_salary %}&min_salary={{ min_salary }}{% endif %}{% if max_salary %}&max_salary={{ max_salary }}{% endif %}" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">&laquo;</a>
                            </li>
                            {% endif %}

                            {% for i in page_obj.paginator.page_range %}
                                {% if page_obj.number == i %}
                                <li class="page-item active"><a class="page-link" href="#">{{ i }}</a></li>
                                {% else %}
                                <li class="page-item"><a class="page-link" href="?page={{ i }}{% if search_query %}&search={{ search_query }}{% endif %}{% if job_type %}&job_type={{ job_type }}{% endif %}{% if location %}&location={{ location }}{% endif %}{% if min_salary %}&min_salary={{ min_salary }}{% endif %}{% if max_salary %}&max_salary={{ max_salary }}{% endif %}">{{ i }}</a></li>
                                {% endif %}
                            {% endfor %}

                            {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if job_type %}&job_type={{ job_type }}{% endif %}{% if location %}&location={{ location }}{% endif %}{% if min_salary %}&min_salary={{ min_salary }}{% endif %}{% if max_salary %}&max_salary={{ max_salary }}{% endif %}" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">&raquo;</a>
                            </li>
                            {% endif %}
                        </ul>
                    </nav>
                    {% endif %}
                </div>
            </div>

            <div class="col-lg-5 col-xl-4">
                <div class="career__sidebar">
                    <!-- Job Search -->
                    <div class="sidebar-widget mb-4">
                        <h4>Job Search</h4>
                        <div class="search-form">
                            <form method="get" action="{% url 'career' %}">
                                <div class="input-group">
                                    <input type="text" class="form-control" name="search" placeholder="Search by title..." value="{{ search_query }}">
                                    <button type="submit" class="btn btn-primary">Search</button>
                                </div>
                            </form>
                        </div>
                    </div>

				<!-- Job Filters -->
				<div class="sidebar-widget mb-4" style="display: flex; flex-direction: column; gap: 15px;">
					<h4 style="margin-bottom: 15px;">Filter Jobs</h4>
					<form method="get" action="{% url 'career' %}">
						{% if search_query %}
						<input type="hidden" name="search" value="{{ search_query }}">
						{% endif %}

						<div class="mb-3" style="display: flex; flex-direction: column; gap: 5px;">
							<label for="job_type" class="form-label" style="color: rgba(228, 230, 213, 0.95);">Job Type</label>
							<select class="form-select" name="job_type" id="job_type" style="
								background-color: rgba(0,0,0,0.2);
								border: 1px solid rgba(104, 242, 160, 0.2);
								color: rgba(228, 230, 213, 0.95);
								border-radius: 15px;
								padding: 8px;">
								<option value="" {% if not job_type %}selected{% endif %}>All Job Types</option>
								{% for job_type_value, job_type_display in job_types %}
								<option value="{{ job_type_value }}" {% if job_type == job_type_value %}selected{% endif %}>{{ job_type_display }}</option>
								{% endfor %}
							</select>
						</div>

						<div class="mb-3" style="display: flex; flex-direction: column; gap: 5px;">
							<label for="location" class="form-label" style="color: rgba(228, 230, 213, 0.95);">Location</label>
							<select class="form-select" name="location" id="location" style="
								background-color: rgba(0,0,0,0.2);
								border: 1px solid rgba(104, 242, 160, 0.2);
								color: rgba(228, 230, 213, 0.95);
								border-radius: 15px;
								padding: 8px;">
								<option value="" {% if not location %}selected{% endif %}>All Locations</option>
								{% for loc in locations %}
								{% if loc %}
								<option value="{{ loc }}" {% if location == loc %}selected{% endif %}>{{ loc }}</option>
								{% endif %}
								{% endfor %}
							</select>
						</div>

                        <!-- Salary Range Slider -->
                        <div class="mb-3" style="display: flex; flex-direction: column; gap: 5px;">
                            <label class="form-label" style="color: rgba(228, 230, 213, 0.95);">Salary Range</label>
                            <div class="slider-container">
                                <div class="slider-track">
                                    <div class="slider-range"></div>
                                    <div class="slider-handle min-handle"></div>
                                    <div class="slider-handle max-handle"></div>
                                </div>
                                <div class="slider-values">
                                    <span class="slider-value min-value">₹0</span>
                                    <span class="slider-value max-value">₹10,00,000</span>
                                </div>
                            </div>
                            <input type="hidden" name="min_salary" id="min_salary" value="{{ min_salary|default:0 }}">
                            <input type="hidden" name="max_salary" id="max_salary" value="{{ max_salary|default:1000000 }}">
                        </div>

						<button type="submit" class="apply-btn w-100" style="padding: 10px; border-radius: 5px;">Apply Filters</button>
					</form>
				</div>

                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="our__info">
                    <div class="our__info--text">
                        <h3 class="magic-hover">Our Placement Cell has been Connecting Students with Opportunities for Over 10 Years!</h3>
                        <p>Our placement cell bridges the gap between academia and industry, helping students find their dream jobs and companies discover exceptional talent. We provide comprehensive career guidance, resume building workshops, and interview preparation sessions to ensure our students are well-prepared for the professional world.
                            <br>
                            We have established strong relationships with leading companies across various sectors, ensuring a diverse range of opportunities for our students. Our dedicated team works tirelessly to match students with positions that align with their skills, interests, and career goals.
                            Our placement process is designed to be transparent, efficient, and student-friendly. We provide continuous support throughout the recruitment cycle, from application to offer acceptance.
                        </p>
                    </div>
                    <div class="our__info--facility">
                        <div class="our__info--facility--item">
                            <div class="our__info--facility--icon">
                                <i class="fa-solid fa-award"></i>
                            </div>
                            <div class="our__info--facility--text">
                                <h6>High Placement Rate</h6>
                                <p>We consistently achieve a placement rate of over 95% across all departments.</p>
                            </div>
                        </div>
                        <div class="our__info--facility--item">
                            <div class="our__info--facility--icon">
                                <i class="fa-solid fa-handshake"></i>
                            </div>
                            <div class="our__info--facility--text">
                                <h6>Industry Partnerships</h6>
                                <p>We collaborate with 100+ companies to provide diverse opportunities.</p>
                            </div>
                        </div>
                        <div class="our__info--facility--item">
                            <div class="our__info--facility--icon">
                                <i class="fa-solid fa-graduation-cap"></i>
                            </div>
                            <div class="our__info--facility--text">
                                <h6>Career Development</h6>
                                <p>We offer comprehensive training programs to enhance employability.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Dual handle slider implementation
        const sliderTrack = document.querySelector('.slider-track');
        const sliderRange = document.querySelector('.slider-range');
        const minHandle = document.querySelector('.min-handle');
        const maxHandle = document.querySelector('.max-handle');
        const minValue = document.querySelector('.min-value');
        const maxValue = document.querySelector('.max-value');
        const minSalaryInput = document.getElementById('min_salary');
        const maxSalaryInput = document.getElementById('max_salary');

        // Set initial values from URL parameters or defaults
        const minSalary = parseInt(minSalaryInput.value) || 0;
        const maxSalary = parseInt(maxSalaryInput.value) || 1000000;

        // Update slider position based on values
        function updateSliderPosition() {
            const trackWidth = sliderTrack.offsetWidth;
            const minPercent = (minSalary / 1000000) * 100;
            const maxPercent = (maxSalary / 1000000) * 100;

            minHandle.style.left = `${minPercent}%`;
            maxHandle.style.left = `${maxPercent}%`;

            sliderRange.style.left = `${minPercent}%`;
            sliderRange.style.width = `${maxPercent - minPercent}%`;

            minValue.textContent = `₹${formatNumber(minSalary)}`;
            maxValue.textContent = `₹${formatNumber(maxSalary)}`;
        }

        // Format number with commas
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Initialize slider
        updateSliderPosition();

        // Handle slider movement
        let activeHandle = null;

        function handleMouseDown(e) {
            activeHandle = e.target;
            activeHandle.classList.add('active');

            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
        }

        function handleMouseMove(e) {
            if (!activeHandle) return;

            const trackRect = sliderTrack.getBoundingClientRect();
            const trackWidth = trackRect.width;

            // Calculate position as percentage
            let percent = ((e.clientX - trackRect.left) / trackWidth) * 100;

            // Constrain to track bounds
            percent = Math.max(0, Math.min(100, percent));

            // Determine which handle is being moved
            if (activeHandle === minHandle) {
                // Ensure min doesn't exceed max
                const maxPercent = parseFloat(maxHandle.style.left);
                percent = Math.min(percent, maxPercent);

                // Update min handle position
                minHandle.style.left = `${percent}%`;
                sliderRange.style.left = `${percent}%`;

                // Update value
                const value = Math.round((percent / 100) * 1000000);
                minSalaryInput.value = value;
                minValue.textContent = `₹${formatNumber(value)}`;
            } else {
                // Ensure max doesn't go below min
                const minPercent = parseFloat(minHandle.style.left);
                percent = Math.max(percent, minPercent);

                // Update max handle position
                maxHandle.style.left = `${percent}%`;
                sliderRange.style.width = `${percent - parseFloat(minHandle.style.left)}%`;

                // Update value
                const value = Math.round((percent / 100) * 1000000);
                maxSalaryInput.value = value;
                maxValue.textContent = `₹${formatNumber(value)}`;
            }
        }

        function handleMouseUp() {
            if (activeHandle) {
                activeHandle.classList.remove('active');
                activeHandle = null;
            }

            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseUp);
        }

        // Add event listeners
        minHandle.addEventListener('mousedown', handleMouseDown);
        maxHandle.addEventListener('mousedown', handleMouseDown);

        // Touch events for mobile
        minHandle.addEventListener('touchstart', function(e) {
            e.preventDefault();
            activeHandle = minHandle;
            activeHandle.classList.add('active');

            document.addEventListener('touchmove', handleTouchMove);
            document.addEventListener('touchend', handleTouchEnd);
        });

        maxHandle.addEventListener('touchstart', function(e) {
            e.preventDefault();
            activeHandle = maxHandle;
            activeHandle.classList.add('active');

            document.addEventListener('touchmove', handleTouchMove);
            document.addEventListener('touchend', handleTouchEnd);
        });

        function handleTouchMove(e) {
            if (!activeHandle) return;

            const trackRect = sliderTrack.getBoundingClientRect();
            const trackWidth = trackRect.width;

            // Calculate position as percentage
            let percent = ((e.touches[0].clientX - trackRect.left) / trackWidth) * 100;

            // Constrain to track bounds
            percent = Math.max(0, Math.min(100, percent));

            // Determine which handle is being moved
            if (activeHandle === minHandle) {
                // Ensure min doesn't exceed max
                const maxPercent = parseFloat(maxHandle.style.left);
                percent = Math.min(percent, maxPercent);

                // Update min handle position
                minHandle.style.left = `${percent}%`;
                sliderRange.style.left = `${percent}%`;

                // Update value
                const value = Math.round((percent / 100) * 1000000);
                minSalaryInput.value = value;
                minValue.textContent = `₹${formatNumber(value)}`;
            } else {
                // Ensure max doesn't go below min
                const minPercent = parseFloat(minHandle.style.left);
                percent = Math.max(percent, minPercent);

                // Update max handle position
                maxHandle.style.left = `${percent}%`;
                sliderRange.style.width = `${percent - parseFloat(minHandle.style.left)}%`;

                // Update value
                const value = Math.round((percent / 100) * 1000000);
                maxSalaryInput.value = value;
                maxValue.textContent = `₹${formatNumber(value)}`;
            }
        }

        function handleTouchEnd() {
            if (activeHandle) {
                activeHandle.classList.remove('active');
                activeHandle = null;
            }

            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }
    });
</script>
{% endblock %}